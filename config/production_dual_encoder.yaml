# =============================================================================
# PRODUCTION MODEL - DUAL ENCODER (Y-Net) CONFIGURATION
# =============================================================================
# Uses DualEncoderSpatialASLNet architecture which processes PCASL and VSASL
# through separate encoder streams before fusion.
#
# Theoretical advantages:
#   - PCASL stream learns ATT-sensitive features
#   - VSASL stream learns transit-independent features
#   - Fusion at bottleneck allows modality-specific representations
#
# NOTE: This is experimental - SpatialASLNet is proven. Use this for comparison.
# =============================================================================

# --- MODEL ARCHITECTURE ---
training:
  model_class_name: DualEncoderSpatialASLNet   # Y-Net dual encoder

  # Constrained output (experimental - enforces physics bounds)
  use_constrained_output: false      # Set true to use Softplus/Sigmoid activations
  max_cbf: 200.0                     # Maximum CBF constraint (ml/100g/min)
  max_att: 5000.0                    # Maximum ATT constraint (ms)

  # Network capacity (each stream gets these features)
  hidden_sizes: [32, 64, 128, 256]
  dropout_rate: 0.1
  norm_type: group

  # Loss configuration
  loss_type: l1
  dc_weight: 0.0                     # No physics constraint
  variance_weight: 0.1
  att_scale: 1.0  # With z-score normalized targets, att_scale should be 1.0
  cbf_weight: 1.0
  att_weight: 1.0

  # Uncertainty bounds
  log_var_cbf_min: -5.0
  log_var_cbf_max: 10.0
  log_var_att_min: -5.0
  log_var_att_max: 14.0

  # Training parameters
  learning_rate: 0.0001
  weight_decay: 0.0001
  batch_size: 24                     # Smaller batch (larger model)
  n_epochs: 200
  n_ensembles: 5

  # Early stopping
  early_stopping_patience: 25
  early_stopping_min_delta: 0.0
  validation_steps_per_epoch: 50

# --- DATA CONFIGURATION ---
data:
  use_offline_dataset: true
  offline_dataset_path: asl_spatial_dataset_500k
  num_samples_to_load: 500000

  pld_values: [500, 1000, 1500, 2000, 2500, 3000]

  # CRITICAL settings
  normalization_mode: global_scale
  global_scale_factor: 10.0
  noise_type: rician

  data_noise_components:
    - thermal
    - physio
    - drift

# --- NOISE ENGINE ---
noise_config:
  snr_range: [2.0, 25.0]
  physio_amp_range: [0.03, 0.15]
  physio_freq_range: [0.5, 2.0]
  drift_range: [-0.03, 0.03]
  spike_probability: 0.02
  spike_magnitude_range: [2.0, 5.0]

# --- PHYSICS ---
simulation:
  T1_artery: 1650.0  # 3T consensus (Alsop 2015)
  T_tau: 1800.0
  alpha_PCASL: 0.85
  alpha_VSASL: 0.56
  T2_factor: 1.0
  alpha_BS1: 1.0

  domain_randomization:
    enabled: true
    T1_artery_range: [1550.0, 2150.0]
    alpha_PCASL_range: [0.75, 0.95]
    alpha_VSASL_range: [0.40, 0.70]
    T_tau_perturb: 0.10

# --- LOGGING ---
wandb:
  wandb_project: asl-production-v1
  wandb_entity: adikondepudi

# --- METADATA ---
_experiment:
  name: production_dual_encoder
  description: Y-Net dual encoder architecture with separate PCASL/VSASL streams
  hypothesis: Modality-specific encoders may learn better representations
